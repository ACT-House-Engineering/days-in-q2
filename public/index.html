<!DOCTYPE html>
<html 
  lang="en"
>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Days in Tulsa</title>
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.1.2/tailwind.min.css'>

  <style>
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #1d1d1d;
        color: #fff;
      }
    }
  </style>

</head>
<body 
  class="dark:bg-black p-0"
>
<!-- partial:index.partial.html -->
<main class="inset-0 flex flex-col justify-center items-center h-full w-full">
  
  <table 
    id="calendar"
    class=""
  ></table>

  <div class="flex flex-col justify-center items-center py-32 mb-64">
    <div>Days in Tulsa</div>
    <div 
        id="days"
        class="font-bold"
        style="font-size: 8rem;"
    ></div>
    <!-- <div 
        class="spacer h-screen"
    ></div> -->
  </div>
</main>

<script>
  
  function getDays(start, end) {
    for(var arr=[],dt=new Date(start); dt<=end; dt.setDate(dt.getDate()+1)){
        arr.push(new Date(dt))
    }
    return arr
  }
  
  function addWeek() {
    const row = calendar.insertRow()
    
    for (let i=0; i<7; i++) {
      const cell = row.insertCell(i)
      
      cell.innerHTML = ''
      
      // console.log(cell)
    }
    
    return row
  }

  function addMonthHeading( day ) {
    const headingRow = calendar.insertRow()

      const monthName = new Intl.DateTimeFormat('en-US', { month: 'long' }).format( day )

      headingRow.innerHTML = /* html */`
        <td class="heading-row" colspan="7">
          <h2 class="font-bold text-lg p-2 mt-12">${ monthName }</h2>
        </td>
      `
    
    return headingRow
  }

  function onElementPresent ( selector ) {

    return new Promise( resolve => {
        function tick(frames) {

            const element = document.querySelector(selector)

            console.log('element', element)

            // We requestAnimationFrame either for 500 frames or until 20 frames with
            // no change have been observed.
            if ( element !== null ) {
                resolve()
            } else {
                requestAnimationFrame( tick )
            }
        }
        tick()
    })
  }
  

  const days = document.querySelector('#days')
  const calendar = document.querySelector('#calendar')

  // Dom First Day in Tulsa
  const daysStart = new Date('April 4, 2021')

  // const daysStart = new Date('September 4, 2021')
  
  const daysInTulsa = getDays(daysStart, new Date())
  
  // Calculate the no. of days between two dates
  // const daysDifference = timeDifference / (1000 * 3600 * 24)

  // console.log('r', daysStart)
  // console.log('d', daysDifference)
  console.log('d', daysInTulsa.length)
  
  
  
  
  addMonthHeading( daysStart )

  let week = addWeek()
  
  // console.log('cell', week, week.cells.length)
  
  for ( const [ i, day ] of daysInTulsa.entries() ) {

    const dayIsToday = day.toDateString() === new Date().toDateString()
    
    const weekDayIndex = day.getDay()
    const dayOfMonth = day.getDate()

    // If this is the first day of the month
    // then add a heading row
    if ( dayOfMonth === 1 ) {
      addMonthHeading( day )
    }
    
    // If this day is a new week
    // then add a new week row
    if ( weekDayIndex === 0 || dayOfMonth === 1 ) {
      week = addWeek()
    }
    
    const dayCell = week.cells[ weekDayIndex ]

    if ( dayIsToday ) {
      dayCell.classList.add('today')
    }
    
    
    // const cell = row.insertCell()
    
    dayCell.innerHTML = /* html */`
      <div class="relative border flex justify-center">
        <div class="font-medium p-3">${ i+1 }</div>
        <div class="absolute top-0 right-0 text-xs opacity-25">${ day.getDate() }</div>
      </div>
    `
    
  }
  
  days.innerHTML = daysInTulsa.length

  onElementPresent ( '.today' )
    .then( () => {
      console.log('Today rendered. Snapping to bottom.')

      window.scrollTo(0, document.body.scrollHeight)
    })


</script>

</body>
</html>
